import random
import math

# Initialize an empty list for teams and a dictionary to hold selected teams
teams = []
playing_teams = {'myself': False, 'enemy': False}


# Class representing a team with attack, defense, and total score
class Team:
    def __init__(self, name, attack, defense):
        self.name = name
        self.attack = attack
        self.defense = defense
        self.total_score = 0

    # Print the team's stats
    def info(self):
        print(self.name + ': Offensive power:' + str(self.attack) +
              ' / Defensive power:' + str(self.defense))

    # Generate a random hit rate based on team's attack power
    def get_hit_rate(self):
        return random.randint(10, self.attack)

    # Generate a random out rate based on team's defense power
    def get_out_rate(self):
        return random.randint(10, self.defense)


# Create and add teams to the global list using .append()
def create_teams():
    global teams
    team1 = Team('Attackers', 80, 20)
    team2 = Team('Defenders', 30, 70)
    team3 = Team('Averages', 50, 50)

    # Clear any existing teams first (in case of replay)
    teams.clear()

    # Append teams to the list
    teams.append(team1)
    teams.append(team2)
    teams.append(team3)


# Display all available teams with their stats
def show_teams():
    index = 1
    print('Information of all teams')
    for team in teams:
        print(str(index))
        team.info()
        index += 1


# Let the user or enemy choose a team
def choice_team(player):
    if player == 'myself':
        player_name = 'Your'
    elif player == 'enemy':
        player_name = 'Opponent\'s'

    # Get user input and assign selected team
    choice_team_number = int(input('Select ' + player_name + ' team(1-3): '))
    playing_teams[player] = teams[choice_team_number - 1]
    print(player_name + ' team is \'' + playing_teams[player].name + '\'')


# Simulate one inning (either top or bottom half)
def get_play_inning(inning):
    if inning == 'top':
        hit_rate = playing_teams['myself'].get_hit_rate()
        out_rate = playing_teams['enemy'].get_out_rate()
    elif inning == 'bottom':
        hit_rate = playing_teams['enemy'].get_hit_rate()
        out_rate = playing_teams['myself'].get_out_rate()

    # Calculate score based on difference between hit and out rate
    inning_score = math.floor((hit_rate - out_rate) / 10)
    if inning_score < 0:
        inning_score = 0
    return inning_score


# Run the full game simulation
def play():
    create_teams()
    show_teams()
    choice_team('myself')
    choice_team('enemy')

    # Initialize scoreboard layout
    score_boards = ['|', 'You     |', 'Opponent|']

    for i in range(9):  # 9 innings
        score_boards[0] += str(i + 1) + '｜'

        # Top half: user's team hits
        inning_score = get_play_inning('top')
        score_boards[1] += str(inning_score) + '｜'
        playing_teams['myself'].total_score += inning_score

        # Bottom half: enemy's team hits
        # If it's the 9th inning and the user's team is already losing, enemy doesn't need to play
        if i == 8 and playing_teams['myself'].total_score < playing_teams['enemy'].total_score:
            score_boards[2] += 'X｜'
        else:
            inning_score = get_play_inning('bottom')
            score_boards[2] += str(inning_score) + '｜'
            playing_teams['enemy'].total_score += inning_score

    # Add total scores to the end of the board
    score_boards[0] += 'R｜'
    score_boards[1] += str(playing_teams['myself'].total_score) + '｜'
    score_boards[2] += str(playing_teams['enemy'].total_score) + '｜'

    # Print final score
    print(score_boards[0])
    print(score_boards[1])
    print(score_boards[2])


# Run the game
play()
